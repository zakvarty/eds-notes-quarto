<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Effective Data Science - 6&nbsp; APIs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./210-data-checklist.html" rel="next">
<link href="./202-data-webscraping.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-EFK9JPMVM8"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-EFK9JPMVM8', { 'anonymize_ip': true});
</script><link rel="stylesheet" href="style.css">
<meta name="twitter:title" content="Effective Data Science - 6&nbsp; APIs">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://eds-notes.zakvarty.com/images/203-data-apis/apis-and-httr.png">
<meta name="twitter:creator" content="zakvarty">
<meta name="twitter:image-height" content="900">
<meta name="twitter:image-width" content="900">
<meta name="twitter:card" content="summary_large_image">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./200-data-introduction.html">Acquiring and Sharing Data</a></li><li class="breadcrumb-item"><a href="./203-data-apis.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">APIs</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Effective Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/zakvarty/eds-notes-quarto/" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About this Course</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./100-workflows-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Effective Workflows</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./101-workflows-organising-your-work.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Organising your work</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./102-workflows-naming-files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Naming Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./103-workflows-organising-your-code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./110-workflows-checklist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Workflows Checklist</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./200-data-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acquiring and Sharing Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./201-data-tabular.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Tabular Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./202-data-webscraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Web Scraping</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./203-data-apis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">APIs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./210-data-checklist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Checklist</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./300-edav-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Exploration and Visualisation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./301-edav-wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Wrangling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./302-edav-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./303-edav-visualisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Data Visualisation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./310-edav-checklist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Checklist</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./400-production-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preparing for Production</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./401-production-reproducibility.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Reproducibility</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./402-production-explainability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Explainability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./403-production-scalability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Scalability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./410-production-checklist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Checklist</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./500-ethics-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Science Ethics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./501-ethics-privacy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Privacy</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./502-ethics-fairness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Fairness</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./503-ethics-conduct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Codes of Conduct</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./510-ethics-checklist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Checklist</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./600-reading-list.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Reading List</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./700-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#aquiring-data-via-an-api" id="toc-aquiring-data-via-an-api" class="nav-link active" data-scroll-target="#aquiring-data-via-an-api"><span class="header-section-number">6.1</span> Aquiring Data Via an API</a></li>
  <li><a href="#why-do-i-need-to-know-about-apis" id="toc-why-do-i-need-to-know-about-apis" class="nav-link" data-scroll-target="#why-do-i-need-to-know-about-apis"><span class="header-section-number">6.2</span> Why do I need to know about APIs?</a></li>
  <li><a href="#what-is-an-api" id="toc-what-is-an-api" class="nav-link" data-scroll-target="#what-is-an-api"><span class="header-section-number">6.3</span> What is an API?</a></li>
  <li><a href="#http" id="toc-http" class="nav-link" data-scroll-target="#http"><span class="header-section-number">6.4</span> HTTP</a></li>
  <li>
<a href="#http-requests" id="toc-http-requests" class="nav-link" data-scroll-target="#http-requests"><span class="header-section-number">6.5</span> HTTP Requests</a>
  <ul class="collapse">
<li><a href="#url" id="toc-url" class="nav-link" data-scroll-target="#url"><span class="header-section-number">6.5.1</span> URL</a></li>
  <li><a href="#method" id="toc-method" class="nav-link" data-scroll-target="#method"><span class="header-section-number">6.5.2</span> Method</a></li>
  <li><a href="#header" id="toc-header" class="nav-link" data-scroll-target="#header"><span class="header-section-number">6.5.3</span> Header</a></li>
  <li><a href="#body" id="toc-body" class="nav-link" data-scroll-target="#body"><span class="header-section-number">6.5.4</span> Body</a></li>
  </ul>
</li>
  <li>
<a href="#http-responses" id="toc-http-responses" class="nav-link" data-scroll-target="#http-responses"><span class="header-section-number">6.6</span> HTTP Responses</a>
  <ul class="collapse">
<li><a href="#status-codes" id="toc-status-codes" class="nav-link" data-scroll-target="#status-codes"><span class="header-section-number">6.6.1</span> Status Codes</a></li>
  </ul>
</li>
  <li>
<a href="#authentication" id="toc-authentication" class="nav-link" data-scroll-target="#authentication"><span class="header-section-number">6.7</span> Authentication</a>
  <ul class="collapse">
<li><a href="#basic-authentication" id="toc-basic-authentication" class="nav-link" data-scroll-target="#basic-authentication"><span class="header-section-number">6.7.1</span> Basic Authentication</a></li>
  <li><a href="#api-key-authentication" id="toc-api-key-authentication" class="nav-link" data-scroll-target="#api-key-authentication"><span class="header-section-number">6.7.2</span> API Key Authentication</a></li>
  </ul>
</li>
  <li><a href="#api-wrappers" id="toc-api-wrappers" class="nav-link" data-scroll-target="#api-wrappers"><span class="header-section-number">6.8</span> API wrappers</a></li>
  <li>
<a href="#geonames-wrapper" id="toc-geonames-wrapper" class="nav-link" data-scroll-target="#geonames-wrapper"><span class="header-section-number">6.9</span> <code>{geonames}</code> wrapper</a>
  <ul class="collapse">
<li><a href="#set-up" id="toc-set-up" class="nav-link" data-scroll-target="#set-up"><span class="header-section-number">6.9.1</span> Set up</a></li>
  <li><a href="#keep-it-secret-keep-it-safe" id="toc-keep-it-secret-keep-it-safe" class="nav-link" data-scroll-target="#keep-it-secret-keep-it-safe"><span class="header-section-number">6.9.2</span> Keep it Secret, Keep it Safe</a></li>
  <li><a href="#using-geonames" id="toc-using-geonames" class="nav-link" data-scroll-target="#using-geonames"><span class="header-section-number">6.9.3</span> Using <code>{geonames}</code></a></li>
  </ul>
</li>
  <li><a href="#what-if-there-is-no-wrapper" id="toc-what-if-there-is-no-wrapper" class="nav-link" data-scroll-target="#what-if-there-is-no-wrapper"><span class="header-section-number">6.10</span> What if there is no wrapper?</a></li>
  <li><a href="#wrapping-up" id="toc-wrapping-up" class="nav-link" data-scroll-target="#wrapping-up"><span class="header-section-number">6.11</span> Wrapping up</a></li>
  <li><a href="#session-information" id="toc-session-information" class="nav-link" data-scroll-target="#session-information"><span class="header-section-number">6.12</span> Session Information</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/zakvarty/eds-notes-quarto/edit/master/203-data-apis.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="data-apis" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">APIs</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Effective Data Science is still a work-in-progress. This chapter is largely complete and just needs final proof reading.</p>
<p>If you would like to contribute to the development of EDS, you may do so at <a href="https://github.com/zakvarty/data_science_notes" class="uri">https://github.com/zakvarty/data_science_notes</a>.</p>
</div>
</div>
<section id="aquiring-data-via-an-api" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="aquiring-data-via-an-api">
<span class="header-section-number">6.1</span> Aquiring Data Via an API</h2>
<div class="medium_right">
<p><img style="border-radius: 10%;" src="images/203-data-apis/apis-and-httr.png" alt="The text APIs and httr, written on a black hexagon."></p>
</div>
<p>We’ve already established that you can’t always rely on tidy, tabular data to land on your desk.</p>
<p>Sometimes you are going to have to go out and gather data for yourself. We have already seen how to scrape information directly from the HTML source of a webpage. But surely there has to be an easer way. Thankfully, there often is!</p>
<p>In this chapter we will cover the basics of obtaining data via an API. This material draws together the <a href="https://zapier.com/learn/apis/">Introduction to APIs</a> book by Brian Cooksey and the <a href="https://stat545.com/diy-web-data.html#interacting-with-an-api">DIY web data</a> section of STAT545 at the University of British Columbia.</p>
</section><section id="why-do-i-need-to-know-about-apis" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="why-do-i-need-to-know-about-apis">
<span class="header-section-number">6.2</span> Why do I need to know about APIs?</h2>
<blockquote class="blockquote">
<p>An API, or application programming interface, is a set of rules that allows different software applications to communicate with each other.</p>
</blockquote>
<p>As a data scientist, you will often need to access data that is stored on remote servers or in cloud-based services. APIs provide a convenient way for data scientists to programmatically retrieve this data, without having to manually download data sets or and process them locally on their own computer.</p>
<p>This has multiple benefits including automation and standardisation of data sharing.</p>
<ul>
<li><p><strong>Automation:</strong> It is much faster for a machine to process a data request than a human. Having a machine handling data requests also scales much better as either the number or the complexity of data requests grows. Additionally, there is a lower risk of introducing human error. For example, a human might accidentally share the wrong data, which can have serious legal repercussions.</p></li>
<li><p><strong>Standardisation:</strong> Having a machine process data requests requires the format of these requests and the associated responses to be standardised. This allows data sharing and retrieval to become a reproducible and programmatic aspect of our work.</p></li>
</ul></section><section id="what-is-an-api" class="level2" data-number="6.3"><h2 data-number="6.3" class="anchored" data-anchor-id="what-is-an-api">
<span class="header-section-number">6.3</span> What is an API?</h2>
<p>So then, if APIs are so great, what exactly are they?</p>
<p>In human-to-human communication, the set of rules governing acceptable behaviour is known as etiquette. Depending on when or where you live, social etiquette can be rather strict. The rules for computer-to-computer communication take this to a whole new level, because with machines there can be no room left for interpretation.</p>
<p>The set of rules governing interactions between computers or programmes is known as a <strong>protocol</strong>.</p>
<p>APIs provide a standard protocol for different programs to interact with one another. This makes it easier for developers to build complex systems by leveraging the functionality of existing services and platforms. The benefits of working in a standardised and modular way apply equally well to sharing data as they do to writing code or organising files.</p>
<p>There are two sides to communication and when <em>machines</em> communicate these are known as the <strong>server</strong> and the <strong>client</strong>.</p>
<div class="medium_right">
<p><img style="border-radius: 10%;" src="images/203-data-apis/server-schematic.png" alt="Schematic diagram representing a computer server. Text above reads 'Servers: don't fear a computer with no screen'."></p>
</div>
<p>Servers can seem intimidating, because unlike your laptop or mobile phone they don’t have their own input and output devices; they have no keyboard, no monitor, and no a mouse. Despite this, servers are just regular computers that are designed to store data and run programmes. Servers don’t have their own input or output devices because they are intended to be used <em>remotely</em>, via another computer. There is no need for a screen or a mouse if the user is miles away. Nothing scary going on here!</p>
<p>People often find clients much less intimidating - they are simply any other computer or application that might contact the sever.</p>
</section><section id="http" class="level2" data-number="6.4"><h2 data-number="6.4" class="anchored" data-anchor-id="http">
<span class="header-section-number">6.4</span> HTTP</h2>
<p>This leads us one step further down the rabbit-hole. An API is a protocol that defines the rules of how applications communicate with one another. But how does this communication happen?</p>
<p>HTTP (Hypertext Transfer Protocol) is the dominant mode communication on the World Wide Web. You can see the secure version of HTTP, HTTPS, at the start of most web addresses up at the top of your browser. For example:</p>
<pre class="http"><code>https://www.zakvarty.com/blog</code></pre>
<p>HTTP is the foundation of data communication on the web and is used to transfer files (such as text, images, and videos) between web servers and clients.</p>
<div class="medium_left">
<p><img style="border-radius: 10%;" src="images/203-data-apis/request-response.png" alt="Schematic diagram showing a request being sent from a client to a server, which returns a response."></p>
</div>
<p>To understand HTTP communications, I find it helpful to imagine the client and the server as being a customer and a waiter at a restaurant. The client makes some request to the server, which then tries to comply before giving a response. The server might respond to confirm that the request was completed successfully. Alternatively, the server might respond with an error message, which is (hopefully) informative about why the request could not be completed.</p>
<p>This request-response model is the basis for HTTP, the communication system used by the majority of APIs.</p>
</section><section id="http-requests" class="level2" data-number="6.5"><h2 data-number="6.5" class="anchored" data-anchor-id="http-requests">
<span class="header-section-number">6.5</span> HTTP Requests</h2>
<p>An HTTP request consists of:</p>
<ul>
<li>Uniform Resource Locator (URL) [unique identifier for a thing]</li>
<li>Method [tells server the type of action requested by client]</li>
<li>Headers [meta-information about request, e.g.&nbsp;device type]</li>
<li>Body [Data the client wants to send to the server]</li>
</ul>
<div class="medium_right">
<p><img style="border-radius: 10%;" src="images/203-data-apis/http-request.png" alt="Schematic diagram showing the structure of an HTTP request, composed of: a URL, method, headers and body."></p>
</div>
<section id="url" class="level3" data-number="6.5.1"><h3 data-number="6.5.1" class="anchored" data-anchor-id="url">
<span class="header-section-number">6.5.1</span> URL</h3>
<p>The URL in a HTTP request specifies where that request is going to be made, for example <code>http://example.com</code>.</p>
</section><section id="method" class="level3" data-number="6.5.2"><h3 data-number="6.5.2" class="anchored" data-anchor-id="method">
<span class="header-section-number">6.5.2</span> Method</h3>
<p>The action that the client wants to take is indicated by a set of well-defined methods or HTTP verbs. The most common HTTP verbs are <code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>PATCH</code>, and <code>DELETE</code>.</p>
<p>The <code>GET</code> verb is used to retrieve a resource from the server, such as a web page or an image. The <code>POST</code> verb is used to send data to the server, such as when submitting a form or uploading a file. The <code>PUT</code> verb is used to replace a resource on the server with a new one, while the <code>PATCH</code> verb is used to update a resource on the server without replacing it entirely. Finally, the <code>DELETE</code> verb is used to delete a resource from the server.</p>
<p>In addition to these common HTTP verbs, there are also several less frequently used verbs. These are used for specialized purposes, such as requesting only the headers of a resource, or testing the connectivity between the client and the server.</p>
</section><section id="header" class="level3" data-number="6.5.3"><h3 data-number="6.5.3" class="anchored" data-anchor-id="header">
<span class="header-section-number">6.5.3</span> Header</h3>
<p>The request headers contain meta-information about the request. This is where information about the device type would be included within the request.</p>
</section><section id="body" class="level3" data-number="6.5.4"><h3 data-number="6.5.4" class="anchored" data-anchor-id="body">
<span class="header-section-number">6.5.4</span> Body</h3>
<p>Finally, the body of the request contains the data that the client is providing to the server.</p>
</section></section><section id="http-responses" class="level2" data-number="6.6"><h2 data-number="6.6" class="anchored" data-anchor-id="http-responses">
<span class="header-section-number">6.6</span> HTTP Responses</h2>
<p>When the server receives a request it will attempt to fulfil it and then send a response back to the client.</p>
<div class="medium_left">
<p><img style="border-radius: 10%;" src="images/203-data-apis/http-response.png" alt="Schematic diagram showing the structure of an HTTP response, composed of: a status code, headers and body."></p>
</div>
<p>A response has a similar structure to a request apart from:</p>
<ul>
<li>responses <strong>do not have</strong> a URL,</li>
<li>responses <strong>do not have</strong> a method,</li>
<li>responses <strong>have</strong> a status code.</li>
</ul>
<section id="status-codes" class="level3" data-number="6.6.1"><h3 data-number="6.6.1" class="anchored" data-anchor-id="status-codes">
<span class="header-section-number">6.6.1</span> Status Codes</h3>
<p>The status code is a 3 digit number, each of which has a specific meaning. Some common error codes that you might (already have) come across are:</p>
<ul>
<li>200: Success,</li>
<li>404: Page not found (all 400s are errors),</li>
<li>503: Page down.</li>
</ul>
<p>In a data science context, a successful response will return the requested data within the data field. This will most likely be given in JSON or XML format.</p>
</section></section><section id="authentication" class="level2" data-number="6.7"><h2 data-number="6.7" class="anchored" data-anchor-id="authentication">
<span class="header-section-number">6.7</span> Authentication</h2>
<p>Now that we know <em>how</em> applications communicate, you might ask how we can control who has access to the API and what types of request they can make. This can be done by the server setting appropriate permissions for each client. But then how does the server verify that the client is really who is claims to be?</p>
<p><strong>Authentication</strong> is a way to ensure that only authorized clients are able to access an API. This is typically done by the server requiring each client to provide some secret information that uniquely identifies them, whenever they make requests to the API. This information allows the API server to validate the authenticity this user before it authorises the request.</p>
<section id="basic-authentication" class="level3" data-number="6.7.1"><h3 data-number="6.7.1" class="anchored" data-anchor-id="basic-authentication">
<span class="header-section-number">6.7.1</span> Basic Authentication</h3>
<p>There are various ways to implement API authentication.</p>
<p>Basic authentication involves each legitimate client having a username and password. An encrypted version of these is included in the <code>Authorization</code> header of the HTTP request. If the hear matches with the server’s records then the request is processed. If not, then a special status code (401) is returned to the client.</p>
<p>Basic authentication is dangerous because it does not put any restrictions on what a client can do once they are authorised. Additional, individualised restrictions can be added by using an alternative authentication scheme.</p>
</section><section id="api-key-authentication" class="level3" data-number="6.7.2"><h3 data-number="6.7.2" class="anchored" data-anchor-id="api-key-authentication">
<span class="header-section-number">6.7.2</span> API Key Authentication</h3>
<p>An API key is long, random string of letters and numbers that is assigned to each authorised user. An API key is distinct from the user’s password and keys are typically issued by the service that provides an API. Using keys rather than basic authentication allows the API provider to track and limit the usage of their API.</p>
<p>For example, a provider may issue a unique API key to each developer or organization that wants to use the API. The provider can then limit access to certain data. They could also limit the number of requests that each key can make in a given time period or prevent access to certain administrative functions, like changing passwords or deleting accounts.</p>
<p>Unlike Basic Authentication, there is no standard way of a client sharing a key with the server. Depending on the API this might be in the <code>Authorization</code> field of the header, at the end of the URL (<code>http://example.com?api_key=my_secret_key</code>), or within the body of the data.</p>
</section></section><section id="api-wrappers" class="level2" data-number="6.8"><h2 data-number="6.8" class="anchored" data-anchor-id="api-wrappers">
<span class="header-section-number">6.8</span> API wrappers</h2>
<p>We’ve learned a lot about how the internet works. Fortunately, a lot of the time we won’t have to worry about all of that new information other than for debugging purposes.</p>
<p>In the best case scenario, a very kind developer has written a “wrapper” function for the API. These wrappers are functions in R that will construct the HTTP request for you. If you are particularly lucky, the API wrapper will also format the response for you, converting it from XML or JSON back into an R object that is ready for immediate use.</p>
</section><section id="geonames-wrapper" class="level2" data-number="6.9"><h2 data-number="6.9" class="anchored" data-anchor-id="geonames-wrapper">
<span class="header-section-number">6.9</span> <code>{geonames}</code> wrapper</h2>
<p><a href="https://ropensci.org/">rOpenSci</a> has a curated list of many wrappers for accessing scientific data using R. We will focus on the <a href="https://www.geonames.org/">GeoNames API</a>, which gives open access to a geographical database. To access this data, we will use wrapper functions provided by the <code>{geonames}</code> <a href="https://docs.ropensci.org/geonames/">package</a>.</p>
<p>The aim here is to illustrate the important steps of getting started with a new API.</p>
<section id="set-up" class="level3" data-number="6.9.1"><h3 data-number="6.9.1" class="anchored" data-anchor-id="set-up">
<span class="header-section-number">6.9.1</span> Set up</h3>
<p>Before we can get any data from the GeoNames API, we first need to do a little bit of set up.</p>
<ol type="1">
<li>Install and load <code>{geonames}</code> from CRAN</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#install.packages("geonames")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">geonames</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Create a <a href="https://www.geonames.org/login">user account</a> for the GeoNames API</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/203-data-apis/sign-up.png" class="img-fluid figure-img" style="width:80.0%" alt="Screenshot of the GeoNames login page. Example text has been added in the fields to create a new user account."></p>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li>Activate the account (see activation email)</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/203-data-apis/confirmation-email.png" class="img-fluid figure-img" style="width:80.0%" alt="Screenshot of the GeoNames confirmation email, which gives a link to click in order to confirm the new account."></p>
</figure>
</div>
</div>
</div>
<ol start="4" type="1">
<li><p>Enable the free web services for your GeoNames account by logging in at this <a href="http://www.geonames.org/enablefreewebservice">link</a>.</p></li>
<li><p>Tell R your credentials for GeoNames.</p></li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>We could use the following code to tell R our credentials, <strong>but we absolutely should not</strong>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>geonamesUsername <span class="op">=</span> <span class="st">"example_username"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This would save our username as an environment variable, but it <em>also</em> puts our API credentials directly into the script. If we share the script with others (internally, externally or publicly) we would be sharing our credentials too. Not good!</p>
</div>
</div>
</section><section id="keep-it-secret-keep-it-safe" class="level3" data-number="6.9.2"><h3 data-number="6.9.2" class="anchored" data-anchor-id="keep-it-secret-keep-it-safe">
<span class="header-section-number">6.9.2</span> Keep it Secret, Keep it Safe</h3>
<p>The solution to this problem is to add our credentials as environment variables in our <code>.Rprofile</code> rather than in this script. The <code>.Rprofile</code> is an R script that is run at the start of every session. It can be created and edited directly, but can also be created and edited from within R.</p>
<p>To make/open your <code>.Rprofile</code> use the <code><a href="https://usethis.r-lib.org/reference/edit.html">edit_r_profile()</a></code> function from the <a href="https://usethis.r-lib.org">usethis</a> package.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://usethis.r-lib.org">usethis</a></span><span class="op">)</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/edit.html">edit_r_profile</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Within this file, add <code>options(geonamesUsername="example_username")</code> on a new line, remembering to replace <code>example_username</code> with your own GeoNames username.</p>
<p>The final step is to <strong>check this this file ends with a blank line</strong>, save it and restart R. Then we are all set to start using <code>{geonames}</code>.</p>
<p>This set up procedure is indicative of most API wrappers, but of course the details will vary between each API. This is why good documentation is important!</p>
<div class="{callout-note}">
<p>If you are using <a href="https://rstudio.github.io/renv/">renv</a> to track the versions of R and the packages you are using take care. For <a href="https://rstudio.github.io/renv/">renv</a> to be effective you have to place your project level <code>.Rprofile</code> under version control - this means you might accidentally share your API credentials.</p>
<p>A workaround for this problem is to create an R file that you <code><a href="https://rdrr.io/r/base/source.html">source()</a></code> from within the project level <code>.Rprofile</code> but is included in <code>.gitignore</code>, so that your credentials remain secret.</p>
</div>
</section><section id="using-geonames" class="level3" data-number="6.9.3"><h3 data-number="6.9.3" class="anchored" data-anchor-id="using-geonames">
<span class="header-section-number">6.9.3</span> Using <code>{geonames}</code>
</h3>
<p>GeoNames has a whole host of <a href="http://www.geonames.org/export/ws-overview.html">different geo-datasets</a> that you can explore. As a first example, let’s get all of the geo-tagged wikipedia articles that are within 1km of Imperial College London.</p>
<div class="cell" data-layout-align="center" data-hash="203-data-apis_cache/html/geonames-api-imperial-neighbours_6a48167640d12a04771065a2f186ff50">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">imperial_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>lat <span class="op">=</span> <span class="fl">51.49876</span>, lon <span class="op">=</span> <span class="op">-</span><span class="fl">0.1749</span><span class="op">)</span></span>
<span><span class="va">search_radius_km</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="va">imperial_neighbours</span> <span class="op">&lt;-</span> <span class="fu">geonames</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/geonames/man/GNfindNearbyWikipedia.html">GNfindNearbyWikipedia</a></span><span class="op">(</span></span>
<span>  lat <span class="op">=</span> <span class="va">imperial_coords</span><span class="op">$</span><span class="va">lat</span>,</span>
<span>  lng <span class="op">=</span> <span class="va">imperial_coords</span><span class="op">$</span><span class="va">lon</span>, </span>
<span>  radius <span class="op">=</span> <span class="va">search_radius_km</span>,</span>
<span>  lang <span class="op">=</span> <span class="st">"en"</span>,                <span class="co"># english language articles</span></span>
<span>  maxRows <span class="op">=</span> <span class="fl">500</span>              <span class="co"># maximum number of results to return </span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Looking at the structure of <code>imperial_neighbours</code> we can see that it is a data frame with one row per geo-tagged wikipedia article.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">imperial_neighbours</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'data.frame':    204 obs. of  13 variables:</span></span>
<span><span class="co">#&gt;  $ summary     : chr  "The Department of Mechanical Engineering is responsible for teaching and research in mechanical engineering at "| __truncated__ "Imperial College Business School is a global business school located in London. The business school was opened "| __truncated__ "Exhibition Road is a street in South Kensington, London which is home to several major museums and academic est"| __truncated__ "Imperial College School of Medicine (ICSM) is the medical school of Imperial College London in England, and one"| __truncated__ ...</span></span>
<span><span class="co">#&gt;  $ elevation   : chr  "20" "18" "19" "24" ...</span></span>
<span><span class="co">#&gt;  $ feature     : chr  "edu" "edu" "landmark" "edu" ...</span></span>
<span><span class="co">#&gt;  $ lng         : chr  "-0.1746" "-0.1748" "-0.17425" "-0.1757" ...</span></span>
<span><span class="co">#&gt;  $ distance    : chr  "0.0335" "0.0494" "0.0508" "0.0558" ...</span></span>
<span><span class="co">#&gt;  $ rank        : chr  "81" "91" "90" "96" ...</span></span>
<span><span class="co">#&gt;  $ lang        : chr  "en" "en" "en" "en" ...</span></span>
<span><span class="co">#&gt;  $ title       : chr  "Department of Mechanical Engineering, Imperial College London" "Imperial College Business School" "Exhibition Road" "Imperial College School of Medicine" ...</span></span>
<span><span class="co">#&gt;  $ lat         : chr  "51.498524" "51.4992" "51.4989722222222" "51.4987" ...</span></span>
<span><span class="co">#&gt;  $ wikipediaUrl: chr  "en.wikipedia.org/wiki/Department_of_Mechanical_Engineering%2C_Imperial_College_London" "en.wikipedia.org/wiki/Imperial_College_Business_School" "en.wikipedia.org/wiki/Exhibition_Road" "en.wikipedia.org/wiki/Imperial_College_School_of_Medicine" ...</span></span>
<span><span class="co">#&gt;  $ countryCode : chr  NA "AE" NA "GB" ...</span></span>
<span><span class="co">#&gt;  $ thumbnailImg: chr  NA NA NA NA ...</span></span>
<span><span class="co">#&gt;  $ geoNameId   : chr  NA NA NA NA ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To confirm we have the correct location we can inspect the title of the first five neighbours.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">imperial_neighbours</span><span class="op">$</span><span class="va">title</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] "Department of Mechanical Engineering, Imperial College London"             </span></span>
<span><span class="co">#&gt; [2] "Imperial College Business School"                                          </span></span>
<span><span class="co">#&gt; [3] "Exhibition Road"                                                           </span></span>
<span><span class="co">#&gt; [4] "Imperial College School of Medicine"                                       </span></span>
<span><span class="co">#&gt; [5] "Department of Civil and Environmental Engineering, Imperial College London"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Nothing too surprising here, mainly departments of the college and Exhibition Road, which runs along one side of the campus. These sorts of check are important - I initially forgot the minus in the longitude and was getting results in East London!</p>
</section></section><section id="what-if-there-is-no-wrapper" class="level2" data-number="6.10"><h2 data-number="6.10" class="anchored" data-anchor-id="what-if-there-is-no-wrapper">
<span class="header-section-number">6.10</span> What if there is no wrapper?</h2>
<p>If there is not a wrapper function, we can still access APIs fairly easilty using the <a href="https://httr.r-lib.org/">httr</a> package.</p>
<p>We will look at an example using <a href="http://www.omdbapi.com/">OMDb</a>, which is an open source version of <a href="https://www.imdb.com/">IMDb</a>, to get information about the movie Mean Girls.</p>
<p>To use the OMDB API you will once again need to <a href="http://www.omdbapi.com/apikey.aspx">request a free API key</a>, follow a verification link and add your API key to your <code>.Rprofile</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Add this to .Rprofile, pasting in your own API key</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>OMDB_API_Key <span class="op">=</span> <span class="st">"PASTE YOUR KEY HERE"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can then restart R and safely access your API key from within your R session.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load your API key into the current R session</span></span>
<span><span class="va">ombd_api_key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">"OMDB_API_Key"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using the documentation for the API, requests have URLs of the following form, where terms in angular brackets should be replaced by you.</p>
<pre><code>http://www.omdbapi.com/?t=&lt;TITLE&gt;&amp;y=&lt;YEAR&gt;&amp;plot=&lt;LENGTH&gt;&amp;r=&lt;FORMAT&gt;&amp;apikey=&lt;API_KEY&gt;</code></pre>
<p>With a little bit of effort, we can write a function that composes this type of request URL for us. We will using the <a href="https://github.com/tidyverse/glue">glue</a> package to help us join strings together.</p>
<p>Running the example we get:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mean_girls_request</span> <span class="op">&lt;-</span> <span class="fu">omdb_url</span><span class="op">(</span></span>
<span>  title <span class="op">=</span> <span class="st">"mean+girls"</span>,</span>
<span>  year <span class="op">=</span>  <span class="st">"2004"</span>,</span>
<span>  plot <span class="op">=</span> <span class="st">"short"</span>,</span>
<span>  format <span class="op">=</span>  <span class="st">"json"</span>,</span>
<span>  api_key <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">"OMDB_API_Key"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then use the <a href="https://httr.r-lib.org/">httr</a> package to construct our request and store the response we get.</p>
<div class="cell" data-layout-align="center">
<pre><code>#&gt; [1] 200</code></pre>
</div>
<p>Thankfully it was a success! If you get a 401 error code here, check that you have clicked the activation link for your API key.</p>
<p>The full structure of the response is quite complicated, but we can easily extract the requested data using <code>content()</code></p>
<div class="cell" data-layout-align="center">
<pre><code>#&gt; $Title
#&gt; [1] "Mean Girls"
#&gt; 
#&gt; $Year
#&gt; [1] "2004"
#&gt; 
#&gt; $Rated
#&gt; [1] "PG-13"
#&gt; 
#&gt; $Released
#&gt; [1] "30 Apr 2004"
#&gt; 
#&gt; $Runtime
#&gt; [1] "97 min"
#&gt; 
#&gt; $Genre
#&gt; [1] "Comedy"
#&gt; 
#&gt; $Director
#&gt; [1] "Mark Waters"
#&gt; 
#&gt; $Writer
#&gt; [1] "Rosalind Wiseman, Tina Fey"
#&gt; 
#&gt; $Actors
#&gt; [1] "Lindsay Lohan, Jonathan Bennett, Rachel McAdams"
#&gt; 
#&gt; $Plot
#&gt; [1] "Cady Heron is a hit with The Plastics, the A-list girl clique at her new school, until she makes the mistake of falling for Aaron Samuels, the ex-boyfriend of alpha Plastic Regina George."
#&gt; 
#&gt; $Language
#&gt; [1] "English, German, Vietnamese, Swahili"
#&gt; 
#&gt; $Country
#&gt; [1] "United States, Canada"
#&gt; 
#&gt; $Awards
#&gt; [1] "7 wins &amp; 25 nominations"
#&gt; 
#&gt; $Poster
#&gt; [1] "https://m.media-amazon.com/images/M/MV5BMjE1MDQ4MjI1OV5BMl5BanBnXkFtZTcwNzcwODAzMw@@._V1_SX300.jpg"
#&gt; 
#&gt; $Ratings
#&gt; $Ratings[[1]]
#&gt; $Ratings[[1]]$Source
#&gt; [1] "Internet Movie Database"
#&gt; 
#&gt; $Ratings[[1]]$Value
#&gt; [1] "7.1/10"
#&gt; 
#&gt; 
#&gt; $Ratings[[2]]
#&gt; $Ratings[[2]]$Source
#&gt; [1] "Rotten Tomatoes"
#&gt; 
#&gt; $Ratings[[2]]$Value
#&gt; [1] "84%"
#&gt; 
#&gt; 
#&gt; $Ratings[[3]]
#&gt; $Ratings[[3]]$Source
#&gt; [1] "Metacritic"
#&gt; 
#&gt; $Ratings[[3]]$Value
#&gt; [1] "66/100"
#&gt; 
#&gt; 
#&gt; 
#&gt; $Metascore
#&gt; [1] "66"
#&gt; 
#&gt; $imdbRating
#&gt; [1] "7.1"
#&gt; 
#&gt; $imdbVotes
#&gt; [1] "416,002"
#&gt; 
#&gt; $imdbID
#&gt; [1] "tt0377092"
#&gt; 
#&gt; $Type
#&gt; [1] "movie"
#&gt; 
#&gt; $DVD
#&gt; [1] "01 Aug 2013"
#&gt; 
#&gt; $BoxOffice
#&gt; [1] "$86,058,055"
#&gt; 
#&gt; $Production
#&gt; [1] "N/A"
#&gt; 
#&gt; $Website
#&gt; [1] "N/A"
#&gt; 
#&gt; $Response
#&gt; [1] "True"</code></pre>
</div>
</section><section id="wrapping-up" class="level2" data-number="6.11"><h2 data-number="6.11" class="anchored" data-anchor-id="wrapping-up">
<span class="header-section-number">6.11</span> Wrapping up</h2>
<p>We have learned a bit more about how the internet works, the benefits of using an API to share data and how to request data from Open APIs.</p>
<p>When obtaining data from the internet it’s vital that you keep your credentials safe, and that don’t do more work than is needed.</p>
<ul>
<li><p>Keep your API keys out of your code. Store them in your <code>.Rprofile</code> (and make sure this is not under version control!)</p></li>
<li><p>Scraping is always a last resort. Is there an API already?</p></li>
<li><p>Writing your own code to access an API can be more painful than necessary.</p></li>
<li><p>Don’t repeat other people, if a suitable wrapper exists then use it.</p></li>
</ul></section><section id="session-information" class="level2" data-number="6.12"><h2 data-number="6.12" class="anchored" data-anchor-id="session-information">
<span class="header-section-number">6.12</span> Session Information</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<p><strong>R version 4.3.1 (2023-06-16)</strong></p>
<p><strong>Platform:</strong> x86_64-apple-darwin20 (64-bit)</p>
<p><strong>locale:</strong> en_US.UTF-8||en_US.UTF-8||en_US.UTF-8||C||en_US.UTF-8||en_US.UTF-8</p>
<p><strong>attached base packages:</strong> <em>stats</em>, <em>graphics</em>, <em>grDevices</em>, <em>utils</em>, <em>datasets</em>, <em>methods</em> and <em>base</em></p>
<p><strong>other attached packages:</strong> geonames(v.0.999)</p>
<p><strong>loaded via a namespace (and not attached):</strong> <em>digest(v.0.6.33)</em>, <em>R6(v.2.5.1)</em>, <em>fastmap(v.1.1.1)</em>, <em>xfun(v.0.41)</em>, <em>glue(v.1.6.2)</em>, <em>knitr(v.1.45)</em>, <em>htmltools(v.0.5.7)</em>, <em>rmarkdown(v.2.25)</em>, <em>cli(v.3.6.2)</em>, <em>pander(v.0.6.5)</em>, <em>compiler(v.4.3.1)</em>, <em>httr(v.1.4.7)</em>, <em>rstudioapi(v.0.15.0)</em>, <em>tools(v.4.3.1)</em>, <em>curl(v.5.2.0)</em>, <em>evaluate(v.0.23)</em>, <em>Rcpp(v.1.0.11)</em>, <em>yaml(v.2.3.8)</em>, <em>rlang(v.1.1.2)</em>, <em>jsonlite(v.1.8.8)</em> and <em>htmlwidgets(v.1.6.4)</em></p>
</div>
</div>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./202-data-webscraping.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Web Scraping</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./210-data-checklist.html" class="pagination-link">
        <span class="nav-page-text">Checklist</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>