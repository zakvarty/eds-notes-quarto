<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Effective Data Science - 7&nbsp; Data Wrangling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./302-edav-analysis.html" rel="next">
<link href="./300-edav-intro.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-EFK9JPMVM8"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-EFK9JPMVM8', { 'anonymize_ip': true});
</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="style.css">
<meta name="twitter:title" content="Effective Data Science - 7&nbsp; Data Wrangling">
<meta name="twitter:description" content="">
<meta name="twitter:creator" content="zakvarty">
<meta name="twitter:card" content="summary">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./300-edav-intro.html">Data Exploration and Visualisation</a></li><li class="breadcrumb-item"><a href="./301-edav-wrangling.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Wrangling</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Effective Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/zakvarty/eds-notes-quarto/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About this Course</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./100-workflows-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Effective Workflows</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./101-workflows-organising-your-work.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Organising your work</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./102-workflows-naming-files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Naming Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./103-workflows-organising-your-code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Code</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./110-workflows-checklist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Workflows Checklist</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./200-data-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acquiring and Sharing Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./201-data-tabular.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Tabular Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./202-data-webscraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Web Scraping</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./203-data-apis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">APIs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./210-data-checklist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Checklist</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./300-edav-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Exploration and Visualisation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./301-edav-wrangling.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Wrangling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./302-edav-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./303-edav-visualisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Data Visualisation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./310-edav-checklist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Checklist</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./400-production-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preparing for Production</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./401-production-reproducibility.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Reproducibility</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./402-production-explainability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Explainability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./403-production-scalability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Scalability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./410-production-checklist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Checklist</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./500-ethics-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Science Ethics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./501-ethics-privacy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Privacy</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./502-ethics-fairness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Fairness</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./503-ethics-conduct.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Codes of Conduct</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./510-ethics-checklist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Checklist</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./600-reading-list.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Reading List</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./700-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#what-is-data-wrangling" id="toc-what-is-data-wrangling" class="nav-link active" data-scroll-target="#what-is-data-wrangling"><span class="header-section-number">7.1</span> What is Data Wrangling?</a></li>
  <li><a href="#example-data-sets" id="toc-example-data-sets" class="nav-link" data-scroll-target="#example-data-sets"><span class="header-section-number">7.2</span> Example Data Sets</a></li>
  <li>
<a href="#viewing-your-data" id="toc-viewing-your-data" class="nav-link" data-scroll-target="#viewing-your-data"><span class="header-section-number">7.3</span> Viewing Your Data</a>
  <ul class="collapse">
<li><a href="#view" id="toc-view" class="nav-link" data-scroll-target="#view"><span class="header-section-number">7.3.1</span> <code>View()</code></a></li>
  <li><a href="#head" id="toc-head" class="nav-link" data-scroll-target="#head"><span class="header-section-number">7.3.2</span> <code>head()</code></a></li>
  <li><a href="#str" id="toc-str" class="nav-link" data-scroll-target="#str"><span class="header-section-number">7.3.3</span> <code>str()</code></a></li>
  <li><a href="#names" id="toc-names" class="nav-link" data-scroll-target="#names"><span class="header-section-number">7.3.4</span> <code>names()</code></a></li>
  </ul>
</li>
  <li>
<a href="#renaming-variables" id="toc-renaming-variables" class="nav-link" data-scroll-target="#renaming-variables"><span class="header-section-number">7.4</span> Renaming Variables</a>
  <ul class="collapse">
<li><a href="#colnames" id="toc-colnames" class="nav-link" data-scroll-target="#colnames"><span class="header-section-number">7.4.1</span> <code>colnames()</code></a></li>
  <li><a href="#dplyrrename" id="toc-dplyrrename" class="nav-link" data-scroll-target="#dplyrrename"><span class="header-section-number">7.4.2</span> <code>dplyr::rename()</code></a></li>
  </ul>
</li>
  <li>
<a href="#subsetting" id="toc-subsetting" class="nav-link" data-scroll-target="#subsetting"><span class="header-section-number">7.5</span> Subsetting</a>
  <ul class="collapse">
<li><a href="#base-r" id="toc-base-r" class="nav-link" data-scroll-target="#base-r"><span class="header-section-number">7.5.1</span> Base R</a></li>
  <li><a href="#filter-and-select" id="toc-filter-and-select" class="nav-link" data-scroll-target="#filter-and-select"><span class="header-section-number">7.5.2</span> <code>filter()</code> and <code>select()</code></a></li>
  </ul>
</li>
  <li>
<a href="#creating-new-variables" id="toc-creating-new-variables" class="nav-link" data-scroll-target="#creating-new-variables"><span class="header-section-number">7.6</span> Creating New Variables</a>
  <ul class="collapse">
<li><a href="#base-r-1" id="toc-base-r-1" class="nav-link" data-scroll-target="#base-r-1"><span class="header-section-number">7.6.1</span> Base R</a></li>
  <li><a href="#dplyrmutate" id="toc-dplyrmutate" class="nav-link" data-scroll-target="#dplyrmutate"><span class="header-section-number">7.6.2</span> <code>dplyr::mutate()</code></a></li>
  <li><a href="#rownames_to_column" id="toc-rownames_to_column" class="nav-link" data-scroll-target="#rownames_to_column"><span class="header-section-number">7.6.3</span> <code>rownames_to_column()</code></a></li>
  <li><a href="#rowids_to_column" id="toc-rowids_to_column" class="nav-link" data-scroll-target="#rowids_to_column"><span class="header-section-number">7.6.4</span> <code>rowids_to_column()</code></a></li>
  </ul>
</li>
  <li><a href="#summaries" id="toc-summaries" class="nav-link" data-scroll-target="#summaries"><span class="header-section-number">7.7</span> Summaries</a></li>
  <li>
<a href="#grouped-operations" id="toc-grouped-operations" class="nav-link" data-scroll-target="#grouped-operations"><span class="header-section-number">7.8</span> Grouped Operations</a>
  <ul class="collapse">
<li><a href="#ungrouping" id="toc-ungrouping" class="nav-link" data-scroll-target="#ungrouping"><span class="header-section-number">7.8.1</span> Ungrouping</a></li>
  </ul>
</li>
  <li><a href="#reordering-factors" id="toc-reordering-factors" class="nav-link" data-scroll-target="#reordering-factors"><span class="header-section-number">7.9</span> Reordering Factors</a></li>
  <li><a href="#be-aware-factors" id="toc-be-aware-factors" class="nav-link" data-scroll-target="#be-aware-factors"><span class="header-section-number">7.10</span> Be Aware: Factors</a></li>
  <li><a href="#be-aware-strings" id="toc-be-aware-strings" class="nav-link" data-scroll-target="#be-aware-strings"><span class="header-section-number">7.11</span> Be Aware: Strings</a></li>
  <li><a href="#be-aware-date-times" id="toc-be-aware-date-times" class="nav-link" data-scroll-target="#be-aware-date-times"><span class="header-section-number">7.12</span> Be Aware: Date-Times</a></li>
  <li><a href="#be-aware-relational-data" id="toc-be-aware-relational-data" class="nav-link" data-scroll-target="#be-aware-relational-data"><span class="header-section-number">7.13</span> Be Aware: Relational Data</a></li>
  <li><a href="#wrapping-up" id="toc-wrapping-up" class="nav-link" data-scroll-target="#wrapping-up"><span class="header-section-number">7.14</span> Wrapping up</a></li>
  <li><a href="#session-information" id="toc-session-information" class="nav-link" data-scroll-target="#session-information"><span class="header-section-number">7.15</span> Session Information</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/zakvarty/eds-notes-quarto/edit/main/301-edav-wrangling.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./300-edav-intro.html">Data Exploration and Visualisation</a></li><li class="breadcrumb-item"><a href="./301-edav-wrangling.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Wrangling</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="edav-wrangling" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data Wrangling</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Effective Data Science is still a work-in-progress. This chapter is largely complete and just needs final proof reading.</p>
<p>If you would like to contribute to the development of EDS, you may do so at <a href="https://github.com/zakvarty/data_science_notes" class="uri">https://github.com/zakvarty/data_science_notes</a>.</p>
</div>
</div>
<section id="what-is-data-wrangling" class="level2" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="what-is-data-wrangling">
<span class="header-section-number">7.1</span> What is Data Wrangling?</h2>
<div class="medium_right">
<p><img style="border-radius: 10%;" src="images/301-edav-wrangling/horst-wrangle-monsters.jpg" alt="Two happy looking round fuzzy monsters, each holding a similarly shaped wrench with the word “wrangle” on it. Between their tools is held up a rectangular data table labelled “TIDY.”"></p>
</div>
<p>Okay, so you’ve got some data. That’s a great start!</p>
<p>You might have had it handed to you by a collaborator, <a href="#data-apis">requested it via an API</a> or <a href="#data-webscraping">scraped it from the raw html of a webpage</a>. In the worst case scenario, you’re an <em>actual</em> scientist (not just a <em>data</em> one) and you spent the last several months of your life painstakingly measuring flower petals or car parts. Now we really want to do something useful with that data.</p>
<p>We’ve seen already how you can load the data into R and pivot between wider and longer formats, but that probably isn’t enough to satisfy your curiosity. You want to be able to view your data, manipulate and subset it, create new variables from existing ones and cross-reference your dataset with others. All of these are things possible in R and are known under various collective names including data manipulation, data munging and data wrangling.</p>
<p>I’ve decided to use the term data wrangling here. That’s because data manipulation sounds boring as heck and data munging is both unpleasant to say and makes me imagine we are squelching through some sort of information swamp.</p>
<p>In what follows, I’ll give a fly-by tour of tools for data wrangling in R, showing some examples along the way. I’ll focus on some of the most common and useful operations and link out to some more extensive guides for wrangling your data in R, that you can refer back to as you need them.</p>
</section><section id="example-data-sets" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="example-data-sets">
<span class="header-section-number">7.2</span> Example Data Sets</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/301-edav-wrangling/palmer-penguins.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%" alt="Palmer penguins R package hex sticker. Three cartoon penguins on a light blue hexagonal logo."></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:60%;">
<p>To demonstrate some standard skills we will use two datasets. The <code>mtcars</code> data comes built into any R installation. The second data set we will look at is the <code>penguins</code> data from <a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a>.</p>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span><span class="va">penguins</span> <span class="op">&lt;-</span> <span class="fu">palmerpenguins</span><span class="fu">::</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html">penguins</a></span></span>
<span><span class="va">cars</span> <span class="op">&lt;-</span> <span class="fu">datasets</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/datasets/mtcars.html">mtcars</a></span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section><section id="viewing-your-data" class="level2" data-number="7.3"><h2 data-number="7.3" class="anchored" data-anchor-id="viewing-your-data">
<span class="header-section-number">7.3</span> Viewing Your Data</h2>
<section id="view" class="level3" data-number="7.3.1"><h3 data-number="7.3.1" class="anchored" data-anchor-id="view">
<span class="header-section-number">7.3.1</span> <code>View()</code>
</h3>
<p>The <code><a href="https://rdrr.io/r/utils/View.html">View()</a></code> function can be used to create a spreadsheet-like view of your data. In RStudio this will open as a new tab.</p>
<p><code><a href="https://rdrr.io/r/utils/View.html">View()</a></code> will work for any “matrix-like” R object, such as a tibble, data frame, vector or matrix. Note the capital letter - the function is called <code><a href="https://rdrr.io/r/utils/View.html">View()</a></code>, not <code>view()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/301-edav-wrangling/view-penguins-screenshot.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%" alt="Screenshot of RStudio files pane, containing a spreadsheet view of the palmer penguins data set."></p>
</figure>
</div>
</div>
</div>
</section><section id="head" class="level3" data-number="7.3.2"><h3 data-number="7.3.2" class="anchored" data-anchor-id="head">
<span class="header-section-number">7.3.2</span> <code>head()</code>
</h3>
<p>For large data sets, you might not want (or be able to) view it all at once. You can then use <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code> to view the first few rows. The integer argument <code>n</code> specifies the number of rows you would like to return.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">penguins</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 8</span></span>
<span><span class="co">#&gt;   species island   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;             &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Torgers…           39.1          18.7               181        3750</span></span>
<span><span class="co">#&gt; 2 Adelie  Torgers…           39.5          17.4               186        3800</span></span>
<span><span class="co">#&gt; 3 Adelie  Torgers…           40.3          18                 195        3250</span></span>
<span><span class="co">#&gt; # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="str" class="level3" data-number="7.3.3"><h3 data-number="7.3.3" class="anchored" data-anchor-id="str">
<span class="header-section-number">7.3.3</span> <code>str()</code>
</h3>
<p>An alternative way to view a data set that is large or has a complicated format is to examine its structure using <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code>. This is a useful way to inspect list-like objects with a nested structure.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span>
<span><span class="co">#&gt; tibble [344 × 8] (S3: tbl_df/tbl/data.frame)</span></span>
<span><span class="co">#&gt;  $ species          : Factor w/ 3 levels "Adelie","Chinstrap",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">#&gt;  $ island           : Factor w/ 3 levels "Biscoe","Dream",..: 3 3 3 3 3 3 3 3 3 3 ...</span></span>
<span><span class="co">#&gt;  $ bill_length_mm   : num [1:344] 39.1 39.5 40.3 NA 36.7 39.3 38.9 39.2 34.1 42 ...</span></span>
<span><span class="co">#&gt;  $ bill_depth_mm    : num [1:344] 18.7 17.4 18 NA 19.3 20.6 17.8 19.6 18.1 20.2 ...</span></span>
<span><span class="co">#&gt;  $ flipper_length_mm: int [1:344] 181 186 195 NA 193 190 181 195 193 190 ...</span></span>
<span><span class="co">#&gt;  $ body_mass_g      : int [1:344] 3750 3800 3250 NA 3450 3650 3625 4675 3475 4250 ...</span></span>
<span><span class="co">#&gt;  $ sex              : Factor w/ 2 levels "female","male": 2 1 1 NA 1 2 1 2 NA NA ...</span></span>
<span><span class="co">#&gt;  $ year             : int [1:344] 2007 2007 2007 2007 2007 2007 2007 2007 2007 2007 ...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="names" class="level3" data-number="7.3.4"><h3 data-number="7.3.4" class="anchored" data-anchor-id="names">
<span class="header-section-number">7.3.4</span> <code>names()</code>
</h3>
<p>If you just want to access the variable names you can do so with the <code><a href="https://rdrr.io/r/base/names.html">names()</a></code> function from base R.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "species"           "island"            "bill_length_mm"   </span></span>
<span><span class="co">#&gt; [4] "bill_depth_mm"     "flipper_length_mm" "body_mass_g"      </span></span>
<span><span class="co">#&gt; [7] "sex"               "year"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similarly, you can explicitly access the row and column names of a data frame or tibble using <code><a href="https://rdrr.io/r/base/colnames.html">colnames()</a></code> or <code><a href="https://rdrr.io/r/base/colnames.html">rownames()</a></code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">cars</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "mpg"  "cyl"  "disp" "hp"   "drat" "wt"   "qsec" "vs"   "am"   "gear"</span></span>
<span><span class="co">#&gt; [11] "carb"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">cars</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "Mazda RX4"           "Mazda RX4 Wag"       "Datsun 710"         </span></span>
<span><span class="co">#&gt;  [4] "Hornet 4 Drive"      "Hornet Sportabout"   "Valiant"            </span></span>
<span><span class="co">#&gt;  [7] "Duster 360"          "Merc 240D"           "Merc 230"           </span></span>
<span><span class="co">#&gt; [10] "Merc 280"            "Merc 280C"           "Merc 450SE"         </span></span>
<span><span class="co">#&gt; [13] "Merc 450SL"          "Merc 450SLC"         "Cadillac Fleetwood" </span></span>
<span><span class="co">#&gt; [16] "Lincoln Continental" "Chrysler Imperial"   "Fiat 128"           </span></span>
<span><span class="co">#&gt; [19] "Honda Civic"         "Toyota Corolla"      "Toyota Corona"      </span></span>
<span><span class="co">#&gt; [22] "Dodge Challenger"    "AMC Javelin"         "Camaro Z28"         </span></span>
<span><span class="co">#&gt; [25] "Pontiac Firebird"    "Fiat X1-9"           "Porsche 914-2"      </span></span>
<span><span class="co">#&gt; [28] "Lotus Europa"        "Ford Pantera L"      "Ferrari Dino"       </span></span>
<span><span class="co">#&gt; [31] "Maserati Bora"       "Volvo 142E"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the <code>cars</code> data, the car model are stored as the row names. This doesn’t really jive with our idea of tidy data - we’ll see how to fix that shortly.</p>
</section></section><section id="renaming-variables" class="level2" data-number="7.4"><h2 data-number="7.4" class="anchored" data-anchor-id="renaming-variables">
<span class="header-section-number">7.4</span> Renaming Variables</h2>
<section id="colnames" class="level3" data-number="7.4.1"><h3 data-number="7.4.1" class="anchored" data-anchor-id="colnames">
<span class="header-section-number">7.4.1</span> <code>colnames()</code>
</h3>
<p>The function <code><a href="https://rdrr.io/r/base/colnames.html">colnames()</a></code> can be used to set, as well as to retrieve, column names.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cars_renamed</span> <span class="op">&lt;-</span> <span class="va">cars</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">cars_renamed</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"miles_per_gallon"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">cars_renamed</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "miles_per_gallon" "cyl"              "disp"            </span></span>
<span><span class="co">#&gt;  [4] "hp"               "drat"             "wt"              </span></span>
<span><span class="co">#&gt;  [7] "qsec"             "vs"               "am"              </span></span>
<span><span class="co">#&gt; [10] "gear"             "carb"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="dplyrrename" class="level3" data-number="7.4.2"><h3 data-number="7.4.2" class="anchored" data-anchor-id="dplyrrename">
<span class="header-section-number">7.4.2</span> <code>dplyr::rename()</code>
</h3>
<p>We can also use functions from <a href="https://dplyr.tidyverse.org">dplyr</a> to rename columns. Let’s alter the second column name.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">cars_renamed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">cars_renamed</span>, cylinders <span class="op">=</span> <span class="va">cyl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">cars_renamed</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "miles_per_gallon" "cylinders"        "disp"            </span></span>
<span><span class="co">#&gt;  [4] "hp"               "drat"             "wt"              </span></span>
<span><span class="co">#&gt;  [7] "qsec"             "vs"               "am"              </span></span>
<span><span class="co">#&gt; [10] "gear"             "carb"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This could be done as part of a pipe if we were making many alterations.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cars_renamed</span> <span class="op">&lt;-</span> <span class="va">cars_renamed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>displacement <span class="op">=</span> <span class="va">disp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>horse_power <span class="op">=</span> <span class="va">hp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>rear_axel_ratio <span class="op">=</span> <span class="va">drat</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">cars_renamed</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "miles_per_gallon" "cylinders"        "displacement"    </span></span>
<span><span class="co">#&gt;  [4] "horse_power"      "rear_axel_ratio"  "wt"              </span></span>
<span><span class="co">#&gt;  [7] "qsec"             "vs"               "am"              </span></span>
<span><span class="co">#&gt; [10] "gear"             "carb"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When using the <a href="https://dplyr.tidyverse.org">dplyr</a> function <code><a href="https://dplyr.tidyverse.org/reference/rename.html">rename()</a></code>, you have to remember the format <code>new_name = old_name</code>. This matches the format used to create a data frame or tibble, but is the opposite order to the python function of the same name and often catches people out.</p>
<p>In the section on <a href="#creating-new-variables">creating new variables</a>, we will see an alternative way of doing this by copying the column and then deleting the original.</p>
</section></section><section id="subsetting" class="level2" data-number="7.5"><h2 data-number="7.5" class="anchored" data-anchor-id="subsetting">
<span class="header-section-number">7.5</span> Subsetting</h2>
<section id="base-r" class="level3" data-number="7.5.1"><h3 data-number="7.5.1" class="anchored" data-anchor-id="base-r">
<span class="header-section-number">7.5.1</span> Base R</h3>
<p>In base R you can extract rows, columns and combinations thereof using index notation.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># First row</span></span>
<span><span class="va">penguins</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 8</span></span>
<span><span class="co">#&gt;   species island   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;             &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Torgers…           39.1          18.7               181        3750</span></span>
<span><span class="co">#&gt; # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</span></span>
<span></span>
<span><span class="co"># First Column </span></span>
<span><span class="va">penguins</span><span class="op">[</span> , <span class="fl">1</span><span class="op">]</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 1</span></span>
<span><span class="co">#&gt;   species</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;  </span></span>
<span><span class="co">#&gt; 1 Adelie </span></span>
<span><span class="co">#&gt; 2 Adelie </span></span>
<span><span class="co">#&gt; 3 Adelie </span></span>
<span><span class="co">#&gt; 4 Adelie </span></span>
<span><span class="co">#&gt; 5 Adelie </span></span>
<span><span class="co">#&gt; 6 Adelie </span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span>
<span></span>
<span><span class="co"># Rows 2-3 of columns 1, 2 and 4</span></span>
<span><span class="va">penguins</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 3</span></span>
<span><span class="co">#&gt;   species island    bill_depth_mm</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;             &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Torgersen          17.4</span></span>
<span><span class="co">#&gt; 2 Adelie  Torgersen          18</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using negative indexing you can remove rows or columns</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Drop all but first row</span></span>
<span><span class="va">penguins</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">344</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 8</span></span>
<span><span class="co">#&gt;   species island   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;             &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Torgers…           39.1          18.7               181        3750</span></span>
<span><span class="co">#&gt; # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Drop all but first column </span></span>
<span><span class="va">penguins</span><span class="op">[</span> , <span class="op">-</span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 1</span></span>
<span><span class="co">#&gt;   species</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;  </span></span>
<span><span class="co">#&gt; 1 Adelie </span></span>
<span><span class="co">#&gt; 2 Adelie </span></span>
<span><span class="co">#&gt; 3 Adelie </span></span>
<span><span class="co">#&gt; 4 Adelie </span></span>
<span><span class="co">#&gt; 5 Adelie </span></span>
<span><span class="co">#&gt; 6 Adelie </span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can also select rows or columns by their names. This can be done using the bracket syntax (<code>[ ]</code>) or the dollar syntax (<code>$</code>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span><span class="op">[</span> ,<span class="st">"species"</span><span class="op">]</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 1</span></span>
<span><span class="co">#&gt;   species</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;  </span></span>
<span><span class="co">#&gt; 1 Adelie </span></span>
<span><span class="co">#&gt; 2 Adelie </span></span>
<span><span class="co">#&gt; 3 Adelie </span></span>
<span><span class="co">#&gt; 4 Adelie </span></span>
<span><span class="co">#&gt; 5 Adelie </span></span>
<span><span class="co">#&gt; 6 Adelie </span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span>
<span><span class="va">penguins</span><span class="op">$</span><span class="va">species</span></span>
<span><span class="co">#&gt;   [1] Adelie    Adelie    Adelie    Adelie    Adelie    Adelie    Adelie   </span></span>
<span><span class="co">#&gt;   [8] Adelie    Adelie    Adelie    Adelie    Adelie    Adelie    Adelie   </span></span>
<span><span class="co">#&gt;  [15] Adelie    Adelie    Adelie    Adelie    Adelie    Adelie    Adelie   </span></span>
<span><span class="co">#&gt;  [22] Adelie    Adelie    Adelie    Adelie    Adelie    Adelie    Adelie   </span></span>
<span><span class="co">#&gt;  [29] Adelie    Adelie    Adelie    Adelie    Adelie    Adelie    Adelie   </span></span>
<span><span class="co">#&gt;  [36] Adelie    Adelie    Adelie    Adelie    Adelie    Adelie    Adelie   </span></span>
<span><span class="co">#&gt;  [43] Adelie    Adelie    Adelie    Adelie    Adelie    Adelie    Adelie   </span></span>
<span><span class="co">#&gt;  [50] Adelie    Adelie    Adelie    Adelie    Adelie    Adelie    Adelie   </span></span>
<span><span class="co">#&gt;  [57] Adelie    Adelie    Adelie    Adelie    Adelie    Adelie    Adelie   </span></span>
<span><span class="co">#&gt;  [64] Adelie    Adelie    Adelie    Adelie    Adelie    Adelie    Adelie   </span></span>
<span><span class="co">#&gt;  [71] Adelie    Adelie    Adelie    Adelie    Adelie    Adelie    Adelie   </span></span>
<span><span class="co">#&gt;  [78] Adelie    Adelie    Adelie    Adelie    Adelie    Adelie    Adelie   </span></span>
<span><span class="co">#&gt;  [85] Adelie    Adelie    Adelie    Adelie    Adelie    Adelie    Adelie   </span></span>
<span><span class="co">#&gt;  [92] Adelie    Adelie    Adelie    Adelie    Adelie    Adelie    Adelie   </span></span>
<span><span class="co">#&gt;  [99] Adelie    Adelie    Adelie    Adelie    Adelie    Adelie    Adelie   </span></span>
<span><span class="co">#&gt; [106] Adelie    Adelie    Adelie    Adelie    Adelie    Adelie    Adelie   </span></span>
<span><span class="co">#&gt; [113] Adelie    Adelie    Adelie    Adelie    Adelie    Adelie    Adelie   </span></span>
<span><span class="co">#&gt; [120] Adelie    Adelie    Adelie    Adelie    Adelie    Adelie    Adelie   </span></span>
<span><span class="co">#&gt; [127] Adelie    Adelie    Adelie    Adelie    Adelie    Adelie    Adelie   </span></span>
<span><span class="co">#&gt; [134] Adelie    Adelie    Adelie    Adelie    Adelie    Adelie    Adelie   </span></span>
<span><span class="co">#&gt; [141] Adelie    Adelie    Adelie    Adelie    Adelie    Adelie    Adelie   </span></span>
<span><span class="co">#&gt; [148] Adelie    Adelie    Adelie    Adelie    Adelie    Gentoo    Gentoo   </span></span>
<span><span class="co">#&gt; [155] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   </span></span>
<span><span class="co">#&gt; [162] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   </span></span>
<span><span class="co">#&gt; [169] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   </span></span>
<span><span class="co">#&gt; [176] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   </span></span>
<span><span class="co">#&gt; [183] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   </span></span>
<span><span class="co">#&gt; [190] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   </span></span>
<span><span class="co">#&gt; [197] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   </span></span>
<span><span class="co">#&gt; [204] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   </span></span>
<span><span class="co">#&gt; [211] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   </span></span>
<span><span class="co">#&gt; [218] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   </span></span>
<span><span class="co">#&gt; [225] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   </span></span>
<span><span class="co">#&gt; [232] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   </span></span>
<span><span class="co">#&gt; [239] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   </span></span>
<span><span class="co">#&gt; [246] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   </span></span>
<span><span class="co">#&gt; [253] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   </span></span>
<span><span class="co">#&gt; [260] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   </span></span>
<span><span class="co">#&gt; [267] Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo    Gentoo   </span></span>
<span><span class="co">#&gt; [274] Gentoo    Gentoo    Gentoo    Chinstrap Chinstrap Chinstrap Chinstrap</span></span>
<span><span class="co">#&gt; [281] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap</span></span>
<span><span class="co">#&gt; [288] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap</span></span>
<span><span class="co">#&gt; [295] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap</span></span>
<span><span class="co">#&gt; [302] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap</span></span>
<span><span class="co">#&gt; [309] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap</span></span>
<span><span class="co">#&gt; [316] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap</span></span>
<span><span class="co">#&gt; [323] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap</span></span>
<span><span class="co">#&gt; [330] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap</span></span>
<span><span class="co">#&gt; [337] Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap Chinstrap</span></span>
<span><span class="co">#&gt; [344] Chinstrap</span></span>
<span><span class="co">#&gt; Levels: Adelie Chinstrap Gentoo</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since <code>penguins</code> is a tibble, these return different types of object. Subsetting a tibble with bracket syntax will return a tibble but extracting a column using the dollar syntax returns a vector of values.</p>
</section><section id="filter-and-select" class="level3" data-number="7.5.2"><h3 data-number="7.5.2" class="anchored" data-anchor-id="filter-and-select">
<span class="header-section-number">7.5.2</span> <code>filter()</code> and <code>select()</code>
</h3>
<p><a href="https://dplyr.tidyverse.org">dplyr</a> has two functions for subsetting, <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> subsets by rows and <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> subsets by column.</p>
<p>In both functions you list what you would like to retain. Filter and select calls can be piped together to subset based on row and column values.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">island</span>, <span class="va">body_mass_g</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 344 × 3</span></span>
<span><span class="co">#&gt;   species island    body_mass_g</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;           &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Torgersen        3750</span></span>
<span><span class="co">#&gt; 2 Adelie  Torgersen        3800</span></span>
<span><span class="co">#&gt; 3 Adelie  Torgersen        3250</span></span>
<span><span class="co">#&gt; 4 Adelie  Torgersen          NA</span></span>
<span><span class="co">#&gt; 5 Adelie  Torgersen        3450</span></span>
<span><span class="co">#&gt; 6 Adelie  Torgersen        3650</span></span>
<span><span class="co">#&gt; # ℹ 338 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">island</span>, <span class="va">body_mass_g</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">body_mass_g</span> <span class="op">&gt;</span> <span class="fl">6000</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 2 × 3</span></span>
<span><span class="co">#&gt;   species island body_mass_g</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;        &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Gentoo  Biscoe        6300</span></span>
<span><span class="co">#&gt; 2 Gentoo  Biscoe        6050</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Subsetting rows can be inverted by negating the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> statement</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">island</span>, <span class="va">body_mass_g</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">body_mass_g</span> <span class="op">&gt;</span> <span class="fl">6000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 340 × 3</span></span>
<span><span class="co">#&gt;   species island    body_mass_g</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;           &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie  Torgersen        3750</span></span>
<span><span class="co">#&gt; 2 Adelie  Torgersen        3800</span></span>
<span><span class="co">#&gt; 3 Adelie  Torgersen        3250</span></span>
<span><span class="co">#&gt; 4 Adelie  Torgersen        3450</span></span>
<span><span class="co">#&gt; 5 Adelie  Torgersen        3650</span></span>
<span><span class="co">#&gt; 6 Adelie  Torgersen        3625</span></span>
<span><span class="co">#&gt; # ℹ 334 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and dropping columns can done by selecting all columns except the one(s) you want to drop.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">island</span>, <span class="va">body_mass_g</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">body_mass_g</span> <span class="op">&gt;</span> <span class="fl">6000</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">island</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 340 × 1</span></span>
<span><span class="co">#&gt;   body_mass_g</span></span>
<span><span class="co">#&gt;         &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1        3750</span></span>
<span><span class="co">#&gt; 2        3800</span></span>
<span><span class="co">#&gt; 3        3250</span></span>
<span><span class="co">#&gt; 4        3450</span></span>
<span><span class="co">#&gt; 5        3650</span></span>
<span><span class="co">#&gt; 6        3625</span></span>
<span><span class="co">#&gt; # ℹ 334 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="creating-new-variables" class="level2" data-number="7.6"><h2 data-number="7.6" class="anchored" data-anchor-id="creating-new-variables">
<span class="header-section-number">7.6</span> Creating New Variables</h2>
<section id="base-r-1" class="level3" data-number="7.6.1"><h3 data-number="7.6.1" class="anchored" data-anchor-id="base-r-1">
<span class="header-section-number">7.6.1</span> Base R</h3>
<p>We can create new variables in base R by assigning a vector of the correct length to a new column name.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cars_renamed</span><span class="op">$</span><span class="va">weight</span> <span class="op">&lt;-</span> <span class="va">cars_renamed</span><span class="op">$</span><span class="va">wt</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we then drop the original column from the data frame, this gives us an alternative way of renaming columns.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cars_renamed</span> <span class="op">&lt;-</span> <span class="va">cars_renamed</span><span class="op">[</span> ,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">cars_renamed</span><span class="op">)</span> <span class="op">==</span> <span class="st">"wt"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cars_renamed</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   miles_per_gallon cylinders displacement horse_power</span></span>
<span><span class="co">#&gt; Mazda RX4                     21.0         6          160         110</span></span>
<span><span class="co">#&gt; Mazda RX4 Wag                 21.0         6          160         110</span></span>
<span><span class="co">#&gt; Datsun 710                    22.8         4          108          93</span></span>
<span><span class="co">#&gt; Hornet 4 Drive                21.4         6          258         110</span></span>
<span><span class="co">#&gt; Hornet Sportabout             18.7         8          360         175</span></span>
<span><span class="co">#&gt;                   rear_axel_ratio  qsec vs am gear carb weight</span></span>
<span><span class="co">#&gt; Mazda RX4                    3.90 16.46  0  1    4    4  2.620</span></span>
<span><span class="co">#&gt; Mazda RX4 Wag                3.90 17.02  0  1    4    4  2.875</span></span>
<span><span class="co">#&gt; Datsun 710                   3.85 18.61  1  1    4    1  2.320</span></span>
<span><span class="co">#&gt; Hornet 4 Drive               3.08 19.44  1  0    3    1  3.215</span></span>
<span><span class="co">#&gt; Hornet Sportabout            3.15 17.02  0  0    3    2  3.440</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One thing to be aware of is that this operation does not preserve column ordering.</p>
<p>Generally speaking, code that relies on columns being in a specific order is fragile - it breaks easily. If possible, you should try to write your code in another way that’s robust to column reordering. I’ve done that here when removing the <code>wt</code> column by looking up the column index as part of my code, rather than assuming it will always be the fourth column.</p>
</section><section id="dplyrmutate" class="level3" data-number="7.6.2"><h3 data-number="7.6.2" class="anchored" data-anchor-id="dplyrmutate">
<span class="header-section-number">7.6.2</span> <code>dplyr::mutate()</code>
</h3>
<p>The function from <a href="https://dplyr.tidyverse.org">dplyr</a> to create new columns is <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>. Let’s create another column that has the car’s weight in kilogrammes rather than tonnes.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cars_renamed</span> <span class="op">&lt;-</span> <span class="va">cars_renamed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>weight_kg <span class="op">=</span> <span class="va">weight</span> <span class="op">*</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cars_renamed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">miles_per_gallon</span>, <span class="va">cylinders</span>, <span class="va">displacement</span>, <span class="va">weight</span>, <span class="va">weight_kg</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   miles_per_gallon cylinders displacement weight weight_kg</span></span>
<span><span class="co">#&gt; Mazda RX4                     21.0         6          160  2.620      2620</span></span>
<span><span class="co">#&gt; Mazda RX4 Wag                 21.0         6          160  2.875      2875</span></span>
<span><span class="co">#&gt; Datsun 710                    22.8         4          108  2.320      2320</span></span>
<span><span class="co">#&gt; Hornet 4 Drive                21.4         6          258  3.215      3215</span></span>
<span><span class="co">#&gt; Hornet Sportabout             18.7         8          360  3.440      3440</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can also create new columns that are functions of multiple other columns.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cars_renamed</span> <span class="op">&lt;-</span> <span class="va">cars_renamed</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>cylinder_adjusted_mpg <span class="op">=</span> <span class="va">miles_per_gallon</span> <span class="op">/</span> <span class="va">cylinders</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="rownames_to_column" class="level3" data-number="7.6.3"><h3 data-number="7.6.3" class="anchored" data-anchor-id="rownames_to_column">
<span class="header-section-number">7.6.3</span> <code>rownames_to_column()</code>
</h3>
<p>One useful example of adding an additional row to a data frame is to convert its row names to a column of the data fame.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">cars_renamed</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="va">cyl</span>, <span class="va">model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt;                    mpg cyl             model</span></span>
<span><span class="co">#&gt; Mazda RX4         21.0   6         Mazda RX4</span></span>
<span><span class="co">#&gt; Mazda RX4 Wag     21.0   6     Mazda RX4 Wag</span></span>
<span><span class="co">#&gt; Datsun 710        22.8   4        Datsun 710</span></span>
<span><span class="co">#&gt; Hornet 4 Drive    21.4   6    Hornet 4 Drive</span></span>
<span><span class="co">#&gt; Hornet Sportabout 18.7   8 Hornet Sportabout</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There’s a neat function called <code>rownames_to_column()</code> in the <a href="https://tibble.tidyverse.org/">tibble</a> package. This will add the row names as the first column and remove the row names all in one step.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"model"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt;               model  mpg cyl disp  hp drat    wt  qsec vs am gear carb</span></span>
<span><span class="co">#&gt; 1         Mazda RX4 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</span></span>
<span><span class="co">#&gt; 2     Mazda RX4 Wag 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</span></span>
<span><span class="co">#&gt; 3        Datsun 710 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</span></span>
<span><span class="co">#&gt; 4    Hornet 4 Drive 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span></span>
<span><span class="co">#&gt; 5 Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="rowids_to_column" class="level3" data-number="7.6.4"><h3 data-number="7.6.4" class="anchored" data-anchor-id="rowids_to_column">
<span class="header-section-number">7.6.4</span> <code>rowids_to_column()</code>
</h3>
<p>Another function from <a href="https://tibble.tidyverse.org/">tibble</a> adds the row id of each observation as a new column. This is often useful when ordering or combining tables.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rowid_to_column</a></span><span class="op">(</span>var <span class="op">=</span> <span class="st">"row_id"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt;   row_id  mpg cyl disp  hp drat    wt  qsec vs am gear carb</span></span>
<span><span class="co">#&gt; 1      1 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</span></span>
<span><span class="co">#&gt; 2      2 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</span></span>
<span><span class="co">#&gt; 3      3 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</span></span>
<span><span class="co">#&gt; 4      4 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span></span>
<span><span class="co">#&gt; 5      5 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="summaries" class="level2" data-number="7.7"><h2 data-number="7.7" class="anchored" data-anchor-id="summaries">
<span class="header-section-number">7.7</span> Summaries</h2>
<p>The <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> function allows you to collapse a data frame into a single row, which using a summary statistic of your choosing.</p>
<p>We can calculate the average bill length of all penguins in a single <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> function call.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="va">penguins</span>, average_bill_length_mm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span><span class="co">#&gt;   average_bill_length_mm</span></span>
<span><span class="co">#&gt;                    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1                     NA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since we have missing values, we might instead want to calculate the mean of the recorded values.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="va">penguins</span>, average_bill_length_mm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span><span class="co">#&gt;   average_bill_length_mm</span></span>
<span><span class="co">#&gt;                    &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1                   43.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also use <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> to gather multiple summaries in a single data frame.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bill_length_mm_summary</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    q_0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    q_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, prob <span class="op">=</span> <span class="fl">0.25</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    q_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    q_3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, prob <span class="op">=</span> <span class="fl">0.75</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    q_4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bill_length_mm_summary</span></span>
<span><span class="co">#&gt; # A tibble: 1 × 8</span></span>
<span><span class="co">#&gt;    mean median   min   q_0   q_1   q_2   q_3   q_4</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1  43.9   44.4  59.6  32.1  39.2  44.4  48.5  59.6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In all, this isn’t overly exciting. You might rightly wonder why you’d want to use <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> when we could just use the simpler base R calls directly.</p>
<p>One benefit of <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> is that it provides certainty that the obejct returned will be of a certain class (a tibble) no matter what summary function is used. However, <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> really comes into its own when you want to apply these summaries to distinct subgroups of the data.</p>
</section><section id="grouped-operations" class="level2" data-number="7.8"><h2 data-number="7.8" class="anchored" data-anchor-id="grouped-operations">
<span class="header-section-number">7.8</span> Grouped Operations</h2>
<p>The real benefit of <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> comes from its combination with <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>. This allows to you calculate the same summary statistics for each level of a factor with only one additional line of code.</p>
<p>Here we’re re-calculating the same set of summary statistics we just found for all penguins, but for each individual species.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    q_0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    q_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, prob <span class="op">=</span> <span class="fl">0.25</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    q_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    q_3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, prob <span class="op">=</span> <span class="fl">0.25</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    q_4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 9</span></span>
<span><span class="co">#&gt;   species    mean median   min   q_0   q_1   q_2   q_3   q_4</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie     38.8   38.8  46    32.1  36.8  38.8  36.8  46  </span></span>
<span><span class="co">#&gt; 2 Chinstrap  48.8   49.6  58    40.9  46.3  49.6  46.3  58  </span></span>
<span><span class="co">#&gt; 3 Gentoo     47.5   47.3  59.6  40.9  45.3  47.3  45.3  59.6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can group by multiple factors to calculate summaries for each distinct combination of levels within your data set. Here we group by combinations of species and the island to which they belong.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguin_summary_stats</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">island</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span></span>
<span>    mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    q_0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    q_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, prob <span class="op">=</span> <span class="fl">0.25</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    q_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    q_3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, prob <span class="op">=</span> <span class="fl">0.25</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    q_4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">bill_length_mm</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'species'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span></span>
<span><span class="va">penguin_summary_stats</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 10</span></span>
<span><span class="co">#&gt; # Groups:   species [3]</span></span>
<span><span class="co">#&gt;   species   island     mean median   min   q_0   q_1   q_2   q_3   q_4</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;     &lt;fct&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie    Biscoe     39.0   38.7  45.6  34.5  37.7  38.7  37.7  45.6</span></span>
<span><span class="co">#&gt; 2 Adelie    Dream      38.5   38.6  44.1  32.1  36.8  38.6  36.8  44.1</span></span>
<span><span class="co">#&gt; 3 Adelie    Torgersen  39.0   38.9  46    33.5  36.7  38.9  36.7  46  </span></span>
<span><span class="co">#&gt; 4 Chinstrap Dream      48.8   49.6  58    40.9  46.3  49.6  46.3  58  </span></span>
<span><span class="co">#&gt; 5 Gentoo    Biscoe     47.5   47.3  59.6  40.9  45.3  47.3  45.3  59.6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="ungrouping" class="level3" data-number="7.8.1"><h3 data-number="7.8.1" class="anchored" data-anchor-id="ungrouping">
<span class="header-section-number">7.8.1</span> Ungrouping</h3>
<p>By default, each call to <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> will undo one level of grouping. This means that our previous result was still grouped by species. We can see this in the tibble output above or by examining the structure of the returned data frame. This tells us that this is an S3 object of class <code>grouped_df</code>, which inherits its properties from a <code>tbl_df</code>, <code>tbl</code>, and <code>data.frame</code> objects.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">penguin_summary_stats</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "grouped_df" "tbl_df"     "tbl"        "data.frame"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since we have grouped by two variables, <a href="https://dplyr.tidyverse.org">dplyr</a> expects us to use two <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function calls before it will return a data frame (or tibble) that is not grouped. One way to satisfy this is to apply a second summary at the species level of grouping.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">penguin_summary_stats</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarise_all</a></span><span class="op">(</span><span class="va">mean</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 × 10</span></span>
<span><span class="co">#&gt;   species   island  mean median   min   q_0   q_1   q_2   q_3   q_4</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;      &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie        NA  38.8   38.7  45.2  33.4  37.0  38.7  37.0  45.2</span></span>
<span><span class="co">#&gt; 2 Chinstrap     NA  48.8   49.6  58    40.9  46.3  49.6  46.3  58  </span></span>
<span><span class="co">#&gt; 3 Gentoo        NA  47.5   47.3  59.6  40.9  45.3  47.3  45.3  59.6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, we won’t always want to do apply another summary. In that case, we can undo the grouping using <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code>. Remembering to ungroup is a common mistake and cause of confusion when working with multiple-group summaries.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="va">penguin_summary_stats</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 5 × 10</span></span>
<span><span class="co">#&gt;   species   island     mean median   min   q_0   q_1   q_2   q_3   q_4</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;     &lt;fct&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Adelie    Biscoe     39.0   38.7  45.6  34.5  37.7  38.7  37.7  45.6</span></span>
<span><span class="co">#&gt; 2 Adelie    Dream      38.5   38.6  44.1  32.1  36.8  38.6  36.8  44.1</span></span>
<span><span class="co">#&gt; 3 Adelie    Torgersen  39.0   38.9  46    33.5  36.7  38.9  36.7  46  </span></span>
<span><span class="co">#&gt; 4 Chinstrap Dream      48.8   49.6  58    40.9  46.3  49.6  46.3  58  </span></span>
<span><span class="co">#&gt; 5 Gentoo    Biscoe     47.5   47.3  59.6  40.9  45.3  47.3  45.3  59.6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There’s an alternative method to achieve the same thing in a single step when using <a href="https://dplyr.tidyverse.org">dplyr</a> versions 1.0.0 and above. This is to to set the <code>.by</code> parameter of the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> function call, which determines the grouping that should be applied to the original data frame, just for this one operation.</p>
<div class="cell" data-layout-align="center">
<pre><code>#&gt; # A tibble: 3 × 2
#&gt;   island    mean_bill_length_mm
#&gt;   &lt;fct&gt;                   &lt;dbl&gt;
#&gt; 1 Torgersen                39.0
#&gt; 2 Biscoe                   45.3
#&gt; 3 Dream                    44.2</code></pre>
</div>
<p>The <code>.by</code> argument applies to a single operation. This means that the result of the <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> call will always be an ungrouped tibble, regardless of the number of grouping columns.</p>
<div class="cell" data-layout-align="center">
<pre><code>#&gt; # A tibble: 5 × 3
#&gt;   island    species   mean_bill_length_mm
#&gt;   &lt;fct&gt;     &lt;fct&gt;                   &lt;dbl&gt;
#&gt; 1 Torgersen Adelie                   39.0
#&gt; 2 Biscoe    Adelie                   39.0
#&gt; 3 Dream     Adelie                   38.5
#&gt; 4 Biscoe    Gentoo                   47.5
#&gt; 5 Dream     Chinstrap                48.8</code></pre>
</div>
<p>See <code><a href="https://dplyr.tidyverse.org/reference/dplyr_by.html">?dplyr_by</a></code> for more information on using the <code>.by</code> argument with <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> and other <a href="https://dplyr.tidyverse.org">dplyr</a> verbs.</p>
</section></section><section id="reordering-factors" class="level2" data-number="7.9"><h2 data-number="7.9" class="anchored" data-anchor-id="reordering-factors">
<span class="header-section-number">7.9</span> Reordering Factors</h2>
<p>R stored factors as integer values, which it then maps to a set of labels. Only factor levels that appear in your data will be assigned a coded integer value and the mapping between factor levels and integers will depend on the order that the labels appear in your data.</p>
<p>This can be annoying, particularly when your factor levels relate to properties that aren’t numerical but do have an inherent ordering to them. In the example below, we have the t-shirt size of twelve people.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tshirts</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, </span>
<span>  size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"L"</span>, <span class="cn">NA</span>, <span class="st">"M"</span>, <span class="st">"S"</span>, <span class="st">"XS"</span>, <span class="st">"M"</span>, <span class="st">"XXL"</span>, <span class="st">"L"</span>, <span class="st">"XS"</span>, <span class="st">"M"</span>, <span class="st">"L"</span>, <span class="st">"S"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">tshirts</span><span class="op">$</span><span class="va">size</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "L"   "M"   "S"   "XS"  "XXL"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Irritatingly, the sizes aren’t in order and extra large isn’t included because it’s not included in this particular sample. This leads to awkward looking summary tables and plots.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tshirts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">size</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 2</span></span>
<span><span class="co">#&gt;   size  count</span></span>
<span><span class="co">#&gt;   &lt;fct&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 L         3</span></span>
<span><span class="co">#&gt; 2 M         3</span></span>
<span><span class="co">#&gt; 3 S         2</span></span>
<span><span class="co">#&gt; 4 XS        2</span></span>
<span><span class="co">#&gt; 5 XXL       1</span></span>
<span><span class="co">#&gt; 6 &lt;NA&gt;      1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can fix this by creating a new variable with the factors explicitly coded in the correct order. We also need to specify that we should not drop empty groups as part of <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tidy_tshirt_levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"XS"</span>, <span class="st">"S"</span>, <span class="st">"M"</span>, <span class="st">"L"</span>, <span class="st">"XL"</span>, <span class="st">"XXL"</span>, <span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tshirts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>size_tidy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">size</span>, levels <span class="op">=</span> <span class="va">tidy_tshirt_levels</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">size_tidy</span>, .drop <span class="op">=</span> <span class="cn">FALSE</span> <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 7 × 2</span></span>
<span><span class="co">#&gt;   size_tidy count</span></span>
<span><span class="co">#&gt;   &lt;fct&gt;     &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 XS            2</span></span>
<span><span class="co">#&gt; 2 S             2</span></span>
<span><span class="co">#&gt; 3 M             3</span></span>
<span><span class="co">#&gt; 4 L             3</span></span>
<span><span class="co">#&gt; 5 XL            0</span></span>
<span><span class="co">#&gt; 6 XXL           1</span></span>
<span><span class="co">#&gt; # ℹ 1 more row</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="be-aware-factors" class="level2" data-number="7.10"><h2 data-number="7.10" class="anchored" data-anchor-id="be-aware-factors">
<span class="header-section-number">7.10</span> Be Aware: Factors</h2>
<p>As we have seen a little already, categorical variables can cause issues when wrangling and presenting data in R. All of these problems are solvable using base R techniques but the <a href="https://forcats.tidyverse.org/">forcats</a> package provides tools for the most common of these problems. This includes functions for changing the order of factor levels or the values with which they are associated.</p>
<p>Some examples functions from the package include:</p>
<ul>
<li>
<code>fct_reorder()</code>: Reordering a factor by another variable.</li>
<li>
<code>fct_infreq()</code>: Reordering a factor by the frequency of values.</li>
<li>
<code>fct_relevel()</code>: Changing the order of a factor by hand.</li>
<li>
<code>fct_lump()</code>: Collapsing the least/most frequent values of a factor into “other”.</li>
</ul>
<p>Examples of each of these can be found in the <a href="https://forcats.tidyverse.org/articles/forcats.html">forcats vignette</a> or the <a href="(https://r4ds.had.co.nz/factors.html)">factors chapter</a> of R for data science.</p>
</section><section id="be-aware-strings" class="level2" data-number="7.11"><h2 data-number="7.11" class="anchored" data-anchor-id="be-aware-strings">
<span class="header-section-number">7.11</span> Be Aware: Strings</h2>
<p>Working with and analysing text data is a skill unto itself. However, it is useful to be able to do some basic manipulation of character strings programatically.</p>
<p>Because R was developed as a statistical programming language, it is well suited to the computational and modelling aspects of working with text data but the base R string manipulation functions can be a bit unwieldy at times.</p>
<p>The <a href="https://stringr.tidyverse.org">stringr</a> package aims to combat this by providing useful helper functions for a range of text management problems. Even when not analysing text data these can be useful, such as when removing prefixes from many column names.</p>
<p>Suppose we wanted to keep only the text following an underscore in these column names. We could do that by using a regular expression to extract lower-case or upper-case letters which follow an underscore.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">poorly_named_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 11</span></span>
<span><span class="co">#&gt;   observation_id   V1_A   V2_B   V3_C   V4_D   V5_E    V6_F      V7_G   V8_H</span></span>
<span><span class="co">#&gt;            &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1              1  0.401 -0.889 -0.170  0.288  1.76  -0.492  -0.496    -0.469</span></span>
<span><span class="co">#&gt; 2              2  0.206 -1.61   0.824 -0.118 -0.919 -0.652  -2.00      2.38 </span></span>
<span><span class="co">#&gt; 3              3 -0.209  0.801  0.390 -1.24   0.718 -1.11   -0.462     1.08 </span></span>
<span><span class="co">#&gt; 4              4  0.250  0.655 -1.15  -0.263  0.366 -0.772  -0.496    -1.51 </span></span>
<span><span class="co">#&gt; 5              5 -0.417 -2.06  -0.224 -0.388 -1.55   0.496   0.0611    1.17 </span></span>
<span><span class="co">#&gt; 6              6  0.782 -0.329 -0.795 -2.27   2.18  -0.0211 -0.000898  0.131</span></span>
<span><span class="co">#&gt; # ℹ 2 more variables: V9_I &lt;dbl&gt;, V10_J &lt;dbl&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">poorly_named_df</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"(?&lt;=_)([a-zA-Z]+)"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "id" "A"  "B"  "C"  "D"  "E"  "F"  "G"  "H"  "I"  "J"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alternatively, can avoid using <a href="https://en.wikipedia.org/wiki/Regular_expression">regular expressions</a>. We can use <code><a href="https://stringr.tidyverse.org/reference/str_split.html">stringr::str_split()</a></code> to divide each column name at the underscore and keep only the second part of each string.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># split column names at underscores and inspect structure of resuting object</span></span>
<span><span class="va">split_strings</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html">str_split</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">poorly_named_df</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">split_strings</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 11</span></span>
<span><span class="co">#&gt;  $ : chr [1:2] "observation" "id"</span></span>
<span><span class="co">#&gt;  $ : chr [1:2] "V1" "A"</span></span>
<span><span class="co">#&gt;  $ : chr [1:2] "V2" "B"</span></span>
<span><span class="co">#&gt;  $ : chr [1:2] "V3" "C"</span></span>
<span><span class="co">#&gt;  $ : chr [1:2] "V4" "D"</span></span>
<span><span class="co">#&gt;  $ : chr [1:2] "V5" "E"</span></span>
<span><span class="co">#&gt;  $ : chr [1:2] "V6" "F"</span></span>
<span><span class="co">#&gt;  $ : chr [1:2] "V7" "G"</span></span>
<span><span class="co">#&gt;  $ : chr [1:2] "V8" "H"</span></span>
<span><span class="co">#&gt;  $ : chr [1:2] "V9" "I"</span></span>
<span><span class="co">#&gt;  $ : chr [1:2] "V10" "J"</span></span>
<span></span>
<span><span class="co"># keep only the second element of each character vector in the list</span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">split_strings</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "id" "A"  "B"  "C"  "D"  "E"  "F"  "G"  "H"  "I"  "J"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Unless you plan to work extensively with text data, I would recommend that you look up such string manipulations as you need them. The <a href="https://r4ds.had.co.nz/strings.html#strings">strings</a> section of R for Data Science is a useful starting point.</p>
</section><section id="be-aware-date-times" class="level2" data-number="7.12"><h2 data-number="7.12" class="anchored" data-anchor-id="be-aware-date-times">
<span class="header-section-number">7.12</span> Be Aware: Date-Times</h2>
<p>Remember <a href="#naming-things-date-order">all the fuss</a> we made about storing dates in the ISO standard format? That was because dates and times are complicated enough to work on without adding extra ambiguity.</p>
<p><span class="math display">\[ \text{YYYY} - \text{MM} - \text{DD}\]</span> Dates, times and time intervals have to reconcile two factors: the physical orbit of the Earth around the Sun and the social and geopolitical mechanisms that determine how we measure and record the passing of time. This makes the history of date and time records fascinating but also make working with this type of data complicated.</p>
<p>Moving from larger to smaller time spans: leap years alter the number of days in a year, months are of variable length (with February’s length changing from year to year). If your data are measured in a place that uses daylight saving, then one day a year will be 23 hours long and another will be 25 hours long. To make things worse, the dates and the hour at which the clocks change are not uniform across countries, which might span multiple time zones and those time-zone boundaries can shift over time.</p>
<p>Even at the level of minutes and seconds we aren’t safe - since the Earth’s orbit is gradually slowing down and a leap second is added approximately every 21 months. Nor are things any better when looking at longer time scales or across cultures, where we might have to account for different calendars: months are added removed and altered over time, other calendar systems still take different approaches to measuring time and using different units and origin points.</p>
<p>With all of these issues you have to be very careful when working with date and time data. Functions to help you with this can be found in the <a href="https://lubridate.tidyverse.org">lubridate</a> package, with examples in the <a href="https://r4ds.had.co.nz/dates-and-times.html#dates-and-times">dates and times</a> chapter of R for data science.</p>
</section><section id="be-aware-relational-data" class="level2" data-number="7.13"><h2 data-number="7.13" class="anchored" data-anchor-id="be-aware-relational-data">
<span class="header-section-number">7.13</span> Be Aware: Relational Data</h2>
<p>When the data you need are stored across two or more data frames you need to be able to cross-reference those and match up values for observational unit. This sort of data is know as relational data, and is used extensively in data science.</p>
<p>The variables you use to match observational units across data frames are known as <em>keys</em>. The primary key belongs to the first table and the foreign key belongs to the secondary table. There are various ways to join these data frames, depending on if you want to retain.</p>
<section id="join-types" class="level4" data-number="7.13.0.1"><h4 data-number="7.13.0.1" class="anchored" data-anchor-id="join-types">
<span class="header-section-number">7.13.0.1</span> Join types</h4>
<p>You might want to keep only observational units that have key variables values in both data frames, this is known as an inner join.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/301-edav-wrangling/join-inner.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>Inner join diagram. Source: R for Data Science</figcaption></figure>
</div>
</div>
</div>
<p>You might instead want to keep all units from the primary table but pad with NAs where there is not a corresponding foreign key in the second table. This results in an <strong>(outer) left-join</strong>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="images/301-edav-wrangling/join-left-right-full.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>Diagram for left, right and outer joins. Source: R for Data Science</figcaption></figure>
</div>
</div>
</div>
<p>Conversely, you might keep all units from the second table but pad with NAs where there is not a corresponding foreign key in the primary table. This is imaginatively named an <strong>(outer) right-join</strong>.</p>
<p>In the <strong>(outer) full join</strong>, all observational units from either table are retained and all missing values are padded with NAs.</p>
<p>Things get more complicated when keys don’t uniquely identify observational units in either one or both of the tables. I’d recommend you start exploring these ideas with the <a href="https://r4ds.had.co.nz/relational-data.html">relational data</a> chapter of R for Data Science.</p>
</section><section id="why-and-where-to-learn-more" class="level4" data-number="7.13.0.2"><h4 data-number="7.13.0.2" class="anchored" data-anchor-id="why-and-where-to-learn-more">
<span class="header-section-number">7.13.0.2</span> Why and where to learn more</h4>
<p>Working with relational data is essential to getting any data science up and running out in the wilds of reality. This is because businesses and companies don’t store all of their data in a huge single csv file. For one this isn’t very efficient, because most cells would be empty. Secondly, it’s not a very secure approach, since you can’t grant partial access to the data. That’s why information is usually stored in many data frames (more generically known as tables) within one or more databases.</p>
<p>These data silos are created, maintained, accessed and destroyed using a relational data base management system. These management systems use code to manage and access the stored data, just like we have seen in the dplyr commands above. You might well have heard of the SQL programming language (and its many variants), which is a popular language for data base management and is the inspiration for the dplyr package and verbs.</p>
<p>If you’d like to learn more then there are many excellent introductory SQL books and courses, I’d recommend picking one that focuses on data analysis or data science unless you really want to dig into efficient storage and querying of databases.</p>
</section></section><section id="wrapping-up" class="level2" data-number="7.14"><h2 data-number="7.14" class="anchored" data-anchor-id="wrapping-up">
<span class="header-section-number">7.14</span> Wrapping up</h2>
<p>We have:</p>
<ul>
<li><p>Learned how to wrangle tabular data in R with <a href="https://dplyr.tidyverse.org">dplyr</a></p></li>
<li><p>Met the idea of relational data and <a href="https://dplyr.tidyverse.org">dplyr</a>’s relationship to SQL</p></li>
<li><p>Become aware of some tricky data types and packages that can help.</p></li>
</ul></section><section id="session-information" class="level2" data-number="7.15"><h2 data-number="7.15" class="anchored" data-anchor-id="session-information">
<span class="header-section-number">7.15</span> Session Information</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<p><strong>R version 4.4.2 (2024-10-31)</strong></p>
<p><strong>Platform:</strong> x86_64-apple-darwin20</p>
<p><strong>locale:</strong> en_GB.UTF-8||en_GB.UTF-8||en_GB.UTF-8||C||en_GB.UTF-8||en_GB.UTF-8</p>
<p><strong>attached base packages:</strong> <em>stats</em>, <em>graphics</em>, <em>grDevices</em>, <em>utils</em>, <em>datasets</em>, <em>methods</em> and <em>base</em></p>
<p><strong>other attached packages:</strong> <em>dplyr(v.1.1.4)</em> and <em>palmerpenguins(v.0.1.1)</em></p>
<p><strong>loaded via a namespace (and not attached):</strong> <em>vctrs(v.0.6.5)</em>, <em>cli(v.3.6.3)</em>, <em>knitr(v.1.49)</em>, <em>rlang(v.1.1.4)</em>, <em>xfun(v.0.50)</em>, <em>stringi(v.1.8.4)</em>, <em>purrr(v.1.0.2)</em>, <em>generics(v.0.1.3)</em>, <em>jsonlite(v.1.8.9)</em>, <em>glue(v.1.8.0)</em>, <em>htmltools(v.0.5.8.1)</em>, <em>rmarkdown(v.2.29)</em>, <em>pander(v.0.6.5)</em>, <em>evaluate(v.1.0.3)</em>, <em>tibble(v.3.2.1)</em>, <em>fastmap(v.1.2.0)</em>, <em>yaml(v.2.3.10)</em>, <em>lifecycle(v.1.0.4)</em>, <em>stringr(v.1.5.1)</em>, <em>compiler(v.4.4.2)</em>, <em>Rcpp(v.1.0.14)</em>, <em>htmlwidgets(v.1.6.4)</em>, <em>pkgconfig(v.2.0.3)</em>, <em>digest(v.0.6.37)</em>, <em>R6(v.2.5.1)</em>, <em>tidyselect(v.1.2.1)</em>, <em>utf8(v.1.2.4)</em>, <em>pillar(v.1.10.1)</em>, <em>magrittr(v.2.0.3)</em>, <em>tools(v.4.4.2)</em> and <em>withr(v.3.0.2)</em></p>
</div>
</div>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/eds-notes\.zakvarty\.com\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./300-edav-intro.html" class="pagination-link" aria-label="Data Exploration and Visualisation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Data Exploration and Visualisation</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./302-edav-analysis.html" class="pagination-link" aria-label="Exploratory Data Analysis">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/zakvarty/eds-notes-quarto/edit/main/301-edav-wrangling.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer></body></html>